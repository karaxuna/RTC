<html>
	<html>
		<script type="text/javascript" src="./scripts/socket.io.js"></script>
		<script type="text/javascript" src="./scripts/RTC.js"></script>
	</html>
	<body>
		My socketId: <span id="socketIdContainer"></span>
<<<<<<< HEAD
		<div>
			<input type="text" id="to" />
			<input type="button" value="connect" onclick="connect(document.getElementById('to').value);" />
		</div>
		<div>
			
		</div>
		<video id="video" autoplay></video>
=======
		<div id="connectContainer">
			<video id="video" autoplay></video>
			<input type="text" id="to" />
			<input type="button" value="connect" onclick="connect(document.getElementById('to').value);" />
		</div>
>>>>>>> e2596ae577257e77def4cf7e934195b03fb09730

		<script type="text/javascript">
			navigator.getUserMedia = navigator.getUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia;

			var socket = io.connect();
			var peer;
			var socketIdContainer = document.getElementById('socketIdContainer');
<<<<<<< HEAD
=======
			var connectContainer = document.getElementById('connectContainer');
>>>>>>> e2596ae577257e77def4cf7e934195b03fb09730

			socket.on('connect', function(){
				peer = new RTCPeer({}, socket);
				socketIdContainer.textContent = socket.socket.sessionid;

				peer.on('offer', function(data){
					navigator.getUserMedia({ audio: true, video: true }, function(stream){
						peer.accept(data, [stream], function(err, con){
							con.on('stream', function(strmArgs){
								video.src = URL.createObjectURL(strmArgs.stream);
<<<<<<< HEAD
							}).on('channel', function(){
						    	con.on('data', function(e){
						    		console.log('data received', e.data);
						    	});
						    });
=======
							});
>>>>>>> e2596ae577257e77def4cf7e934195b03fb09730
						});
					}, function(){
						peer.reject(data, function(){
							console.log('you rejected connection');
						});
					});
				});
			});

			function connect(to){
				navigator.getUserMedia({ audio: true, video: true }, function(stream){
					peer.offer(to, [stream], function(err, con){
						if(err)
							console.error(err);
						else
<<<<<<< HEAD
						    con.on('stream', function(e){
						        video.src = URL.createObjectURL(e.stream);
=======
						    con.on('stream', function(strmArgs){
						        video.src = URL.createObjectURL(strmArgs.stream);
>>>>>>> e2596ae577257e77def4cf7e934195b03fb09730
						    }).on('rejected', function(){
						    	console.log('peer rejected connection');
						    }).on('accepted', function(){
						    	console.log('peer accepted connection');
<<<<<<< HEAD
						    }).on('channel', function(){
								var data = { konichiva: 'vatashiva' };
								con.send(JSON.stringify(data));
								console.log('data sent: ', data);
							}).on('offerfailed', function(e){
								console.error(e.err);
=======
						    }).on('offerfailed', function(data){
								console.error(data.err);
>>>>>>> e2596ae577257e77def4cf7e934195b03fb09730
							});
					});
				}, function(err){
					console.error(err);
				});
			}
		</script>
	</body>
</html>